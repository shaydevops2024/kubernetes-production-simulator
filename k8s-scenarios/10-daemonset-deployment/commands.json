{
  "scenario_id": "10-daemonset-deployment",
  "difficulty": "easy",
  "duration": "15 min",
  "commands": [
    {
      "name": "Step 1: Create Namespace",
      "command": "kubectl create namespace scenarios --dry-run=client -o yaml | kubectl apply -f -",
      "description": "Create scenarios namespace",
      "explanation": "Creates namespace for DaemonSet demonstration.",
      "what_it_does": "Creates 'scenarios' namespace if needed.",
      "next_step": "Deploy DaemonSet to all nodes."
    },
    {
      "name": "Step 2: Deploy DaemonSet",
      "command": "kubectl apply -f k8s-scenarios/10-daemonset-deployment/daemonset.yaml -n scenarios",
      "description": "Deploy Fluentd DaemonSet",
      "explanation": "Creates DaemonSet that schedules exactly one pod on every node in the cluster. DaemonSets are ideal for node-level services like logging agents, monitoring exporters, or storage daemons.",
      "what_it_does": "Creates fluentd-ds DaemonSet which deploys one pod per node.",
      "next_step": "Verify one pod per node."
    },
    {
      "name": "Step 3: List DaemonSet Pods",
      "command": "kubectl get pods -n scenarios -l app=daemonset-demo -o wide",
      "description": "View pods distributed across all nodes",
      "explanation": "Should see one pod per node in your cluster. The NODE column shows each pod is on a different node. This is DaemonSet's guarantee: exactly one pod per node.",
      "what_it_does": "Lists all fluentd pods with their node assignments.",
      "next_step": "Check DaemonSet status."
    },
    {
      "name": "Step 4: Check DaemonSet Status",
      "command": "kubectl get daemonset daemonset-demo -n scenarios",
      "description": "View DaemonSet pod counts",
      "explanation": "DESIRED shows target node count, CURRENT shows pods created, READY shows pods passing readiness, AVAILABLE shows pods ready to serve. All should match your node count.",
      "what_it_does": "Displays DaemonSet with current vs desired pod count.",
      "next_step": "Describe DaemonSet for more details."
    },
    {
      "name": "Step 5: Describe DaemonSet",
      "command": "kubectl describe daemonset daemonset-demo -n scenarios",
      "description": "View detailed DaemonSet configuration",
      "explanation": "Shows pod template, update strategy (RollingUpdate), selectors, and events. DaemonSets use RollingUpdate by default - updating one pod at a time when image changes.",
      "what_it_does": "Displays full DaemonSet spec and status.",
      "next_step": "Understand node selection."
    },
    {
      "name": "Step 6: View Node Count",
      "command": "kubectl get nodes --no-headers | wc -l",
      "description": "Count nodes in cluster",
      "explanation": "This number should match your DaemonSet pod count. If you add a node, DaemonSet automatically schedules a pod on it. If you remove a node, its pod is deleted.",
      "what_it_does": "Counts total nodes in the cluster.",
      "next_step": "View DaemonSet events."
    },
    {
      "name": "Step 7: Check DaemonSet Events",
      "command": "kubectl get events -n scenarios --field-selector involvedObject.name=daemonset-demo --sort-by='.lastTimestamp'",
      "description": "See DaemonSet scheduling events",
      "explanation": "Shows pod creation events for each node. You'll see 'SuccessfulCreate' events for each pod scheduled.",
      "what_it_does": "Lists events related to DaemonSet pod scheduling.",
      "next_step": "Review scenario summary and key learnings."
    },
    {
      "name": "Step 8: Scenario Summary",
      "command": "echo '=== DaemonSet Scenario Complete! ==='",
      "description": "Summary of what you learned",
      "explanation": "ðŸŽ“ **What You Learned:**\n\n**DaemonSets** - Ensure exactly one pod runs on every node in the cluster\n- DaemonSets guarantee exactly one pod per node (not 0, not 2+)\n- Automatically scale with cluster size (add node = add pod)\n- Ideal for node-level services like logging, monitoring, networking\n- Use RollingUpdate strategy by default for safe updates\n- Can use nodeSelectors/tolerations to control which nodes get pods\n\n**Key Concepts:**\nâœ… One pod per node guarantee\nâœ… Automatic scheduling on new nodes\nâœ… Automatic removal when nodes are deleted\nâœ… HostPath volumes for accessing node filesystems\nâœ… Common use cases: logging agents, monitoring exporters, network plugins\n\n**Commands Used:**\n- `kubectl create namespace scenarios` - Creates the namespace for scenario resources\n- `kubectl apply -f daemonset.yaml` - Deploys DaemonSet to all nodes\n- `kubectl get pods -l app=daemonset-demo -o wide` - Lists pods with node assignments\n- `kubectl get daemonset daemonset-demo` - Shows DaemonSet status and counts\n- `kubectl describe daemonset daemonset-demo` - Displays detailed configuration\n- `kubectl get nodes --no-headers | wc -l` - Counts nodes in cluster\n- `kubectl get events` - Views DaemonSet scheduling events",
      "what_it_does": "Displays comprehensive summary of DaemonSets, use cases, and key learnings.",
      "next_step": "Ready for cleanup!",
      "show_yaml": true
    },
    {
      "name": "Cleanup: Delete DaemonSet",
      "command": "kubectl delete -f k8s-scenarios/10-daemonset-deployment/daemonset.yaml -n scenarios",
      "description": "Remove DaemonSet and all pods",
      "explanation": "Deletes the DaemonSet, which automatically removes all pods from all nodes.",
      "what_it_does": "Removes daemonset-demo DaemonSet and all its pods.",
      "next_step": "Cleanup complete!",
      "cleanup": true
    }
  ]
}