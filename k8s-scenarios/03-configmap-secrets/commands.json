{
  "scenario_id": "03-configmap-secrets",
  "difficulty": "easy",
  "duration": "20 min",
  "commands": [
    {
      "name": "Step 1: Create Namespace",
      "command": "kubectl create namespace scenarios --dry-run=client -o yaml | kubectl apply -f -",
      "description": "Create scenarios namespace",
      "explanation": "Creates the dedicated namespace for all scenario resources.",
      "what_it_does": "Creates 'scenarios' namespace if it doesn't exist.",
      "next_step": "Deploy application with ConfigMap and Secret."
    },
    {
      "name": "Step 2: Create ConfigMap",
      "command": "kubectl apply -f k8s-scenarios/03-configmap-secrets/configmap.yaml",
      "description": "Create ConfigMap with application settings",
      "explanation": "ConfigMaps store non-sensitive configuration data as key-value pairs. This creates 'app-config' with settings like app.color=blue, app.mode=production, and a config.json file.",
      "what_it_does": "Creates ConfigMap 'app-config' with application configuration data.",
      "next_step": "Create the Secret for sensitive data."
    },
    {
      "name": "Step 3: Create Secret",
      "command": "kubectl apply -f k8s-scenarios/03-configmap-secrets/secret.yaml",
      "description": "Create Secret with database credentials",
      "explanation": "Secrets store sensitive data (passwords, tokens, keys) in base64-encoded format. This creates 'db-credentials' with username='admin' and password='supersecret123'. Note: base64 is encoding, not encryption!",
      "what_it_does": "Creates Secret 'db-credentials' with database username and password.",
      "next_step": "Deploy the application that uses both ConfigMap and Secret."
    },
    {
      "name": "Step 4: Deploy Application",
      "command": "kubectl apply -f k8s-scenarios/03-configmap-secrets/deployment.yaml",
      "description": "Deploy application using ConfigMap and Secret",
      "explanation": "The deployment references ConfigMap and Secret. Environment variables (APP_COLOR, DB_USER, DB_PASSWORD) are injected from these resources. The ConfigMap is also mounted as a volume at /etc/config.",
      "what_it_does": "Creates 2-replica deployment 'configmap-demo-app' using the configuration.",
      "next_step": "Verify all resources were created successfully."
    },
    {
      "name": "Step 5: Check ConfigMap",
      "command": "kubectl get configmap app-config -n scenarios -o yaml",
      "description": "View ConfigMap contents",
      "explanation": "ConfigMaps store non-sensitive configuration as key-value pairs. This one contains app.color=blue, app.mode=production, etc. Data is stored in plain text.",
      "what_it_does": "Displays full ConfigMap YAML showing all configuration data.",
      "next_step": "Now check the Secret."
    },
    {
      "name": "Step 6: Check Secret",
      "command": "kubectl get secret db-credentials -n scenarios -o jsonpath='{.data}' | jq",
      "description": "View Secret keys (values are base64 encoded)",
      "explanation": "Secrets store sensitive data base64-encoded (not encrypted). Shows keys 'username' and 'password'. To decode: echo '<value>' | base64 -d. Try decoding to see 'admin' and 'supersecret123'.",
      "what_it_does": "Displays Secret data keys with base64-encoded values.",
      "next_step": "Verify pods are using the configuration."
    },
    {
      "name": "Step 7: Verify Environment Variables",
      "command": "kubectl exec -n scenarios deployment/configmap-demo-app -- env | grep -E 'APP_COLOR|DB_USER'",
      "description": "Check environment variables injected from ConfigMap and Secret",
      "explanation": "APP_COLOR comes from ConfigMap (should be 'blue'), DB_USER comes from Secret (should be 'admin'). This proves the configuration is injected into containers.",
      "what_it_does": "Lists specific environment variables inside a running pod.",
      "next_step": "Test updating ConfigMap to see the update process."
    },
    {
      "name": "Step 8: Update ConfigMap",
      "command": "kubectl patch configmap app-config -n scenarios --type merge -p '{\"data\":{\"app.color\":\"green\"}}'",
      "description": "Change app color from blue to green",
      "explanation": "Updates ConfigMap in-place. IMPORTANT: Existing pods don't automatically see changes when using env vars. New pods or restarted pods will get the updated value. For immediate updates, use volume mounts instead.",
      "what_it_does": "Modifies the app.color value in ConfigMap from blue to green.",
      "next_step": "Restart pods to pick up the ConfigMap change."
    },
    {
      "name": "Step 9: Restart Deployment",
      "command": "kubectl rollout restart deployment configmap-demo-app -n scenarios",
      "description": "Restart pods to load updated ConfigMap",
      "explanation": "Performs a rolling restart, replacing pods one at a time. New pods will read the updated ConfigMap and have APP_COLOR=green. This is the only way to refresh env vars from ConfigMaps.",
      "what_it_does": "Triggers controlled restart of all pods in the deployment.",
      "next_step": "Wait for rollout to complete, then verify the change."
    },
    {
      "name": "Step 10: Verify Updated Value",
      "command": "kubectl exec -n scenarios deployment/configmap-demo-app -- env | grep APP_COLOR",
      "description": "Confirm APP_COLOR is now green",
      "explanation": "Should display APP_COLOR=green, proving the pod picked up the updated ConfigMap after restart.",
      "what_it_does": "Shows the current APP_COLOR environment variable value.",
      "next_step": "Review what you've learned in the summary."
    },
    {
      "name": "Step 11: Scenario Summary",
      "command": "echo '=== Scenario Complete! ==='",
      "description": "Summary of what you learned",
      "explanation": "ðŸŽ“ **What You Learned:**\n\n**ConfigMaps** - Store non-sensitive configuration (app.color, app.mode, config files)\n- Created with: kubectl apply -f configmap.yaml\n- Viewed with: kubectl get configmap app-config -o yaml\n- Updated with: kubectl patch configmap\n- Injected as: Environment variables and volume mounts\n\n**Secrets** - Store sensitive data (passwords, tokens, API keys)\n- Created with: kubectl apply -f secret.yaml  \n- Data is base64-encoded (NOT encrypted!)\n- Viewed with: kubectl get secret db-credentials -o jsonpath\n- Decode with: echo '<value>' | base64 -d\n- Injected as: Environment variables (DB_USER, DB_PASSWORD)\n\n**Key Concepts:**\nâœ… ConfigMaps for non-sensitive config, Secrets for sensitive data\nâœ… Environment variables don't auto-update - need pod restart\nâœ… Volume mounts can auto-update (for file-based config)\nâœ… Rolling restart preserves availability: kubectl rollout restart\nâœ… Secrets are base64-encoded, not encrypted (use encryption at rest!)\n\n**Commands Used:**\n- kubectl apply -f <file> - Create resources\n- kubectl get configmap/secret - View resources\n- kubectl patch configmap - Update configuration\n- kubectl rollout restart - Restart deployment\n- kubectl exec deployment/<name> -- <cmd> - Run command in pod",
      "what_it_does": "Displays comprehensive summary of ConfigMaps, Secrets, and key learnings.",
      "next_step": "Ready for cleanup!",
      "show_yaml": true
    },
    {
      "name": "Cleanup: Delete All Resources",
      "command": "kubectl delete -f k8s-scenarios/03-configmap-secrets/ -n scenarios",
      "description": "Remove ConfigMap, Secret, and Deployment",
      "explanation": "Deletes all resources created in this scenario by applying the directory. This removes app-config ConfigMap, db-credentials Secret, and configmap-demo-app Deployment.",
      "what_it_does": "Removes all resources: ConfigMap, Secret, and Deployment from the scenarios namespace.",
      "next_step": "Cleanup complete!",
      "cleanup": true
    }
  ]
}