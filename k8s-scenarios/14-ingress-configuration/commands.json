{
  "scenario_id": "14-ingress-configuration",
  "difficulty": "medium",
  "duration": "25 min",
  "commands": [
    {
      "name": "Step 1: Create Namespace",
      "command": "kubectl create namespace scenarios --dry-run=client -o yaml | kubectl apply -f -",
      "description": "Create scenarios namespace",
      "explanation": "Creates namespace for Ingress testing.",
      "what_it_does": "Creates 'scenarios' namespace if needed.",
      "next_step": "Deploy application for Ingress routing."
    },
    {
      "name": "Step 2: Deploy Application",
      "command": "kubectl apply -f deployment.yaml -n scenarios",
      "description": "Deploy app with Service and Ingress",
      "explanation": "Creates deployment (2 replicas), ClusterIP service, and Ingress resource. Ingress provides HTTP routing, allowing multiple services to share one external IP/hostname.",
      "what_it_does": "Creates ingress-demo deployment, service, and Ingress with routing rules.",
      "next_step": "Verify resources created."
    },
    {
      "name": "Step 3: Check Ingress Resource",
      "command": "kubectl get ingress ingress-demo -n scenarios",
      "description": "View Ingress with routing rules",
      "explanation": "Shows Ingress with HOSTS (demo.local), ADDRESS (may take 1-2 minutes to populate with load balancer IP), and PORTS (80).",
      "what_it_does": "Displays Ingress resource with host and address.",
      "next_step": "Describe Ingress for detailed rules."
    },
    {
      "name": "Step 4: Describe Ingress",
      "command": "kubectl describe ingress ingress-demo -n scenarios",
      "description": "View detailed Ingress configuration",
      "explanation": "Shows Rules section with host (demo.local), path (/), and backend service (ingress-demo-service:80). Ingress Controller uses these rules to route HTTP traffic.",
      "what_it_does": "Displays full Ingress spec including routing rules and backends.",
      "next_step": "Check Ingress Controller is running."
    },
    {
      "name": "Step 5: Check Ingress Controller",
      "command": "kubectl get pods -n ingress-nginx -l app.kubernetes.io/component=controller",
      "description": "Verify Ingress Controller is running (adjust namespace if using different controller)",
      "explanation": "Ingress resources are just configuration - you need an Ingress Controller (NGINX, Traefik, etc.) to implement them. This checks for NGINX Ingress Controller. If not found, check your ingress-nginx installation.",
      "what_it_does": "Lists Ingress Controller pods.",
      "next_step": "Test HTTP access through Ingress."
    },
    {
      "name": "Step 6: Get Ingress Address",
      "command": "kubectl get ingress ingress-demo -n scenarios -o jsonpath='{.status.loadBalancer.ingress[0].ip}'",
      "description": "Get external IP for Ingress (may be empty if using NodePort or localhost)",
      "explanation": "Shows the external IP or hostname where Ingress is accessible. In cloud environments, this is a LoadBalancer IP. With Kind/Minikube, may need port-forward instead.",
      "what_it_does": "Extracts Ingress external address.",
      "next_step": "Test HTTP request to Ingress."
    },
    {
      "name": "Step 7: Test Ingress (Port-Forward Method)",
      "command": "kubectl port-forward -n scenarios service/ingress-demo-service 8080:80 &",
      "description": "Port-forward to test service access (run in background)",
      "explanation": "For local testing, port-forward allows access without external LoadBalancer. Service will be at localhost:8080. Stop with: pkill -f 'port-forward.*ingress-demo-service'",
      "what_it_does": "Forwards local port 8080 to service port 80.",
      "next_step": "Test with curl or browser."
    },
    {
      "name": "Step 8: Test HTTP Request",
      "command": "sleep 2 && curl -s http://localhost:8080",
      "description": "Test HTTP access through port-forward",
      "explanation": "Should see HTML response from nginx. In production, you'd use the Ingress hostname (demo.local) with DNS pointing to the Ingress LoadBalancer IP.",
      "what_it_does": "Makes HTTP request to verify service is accessible.",
      "next_step": "View Ingress Controller logs."
    },
    {
      "name": "Step 9: View Ingress Logs",
      "command": "kubectl logs -n ingress-nginx -l app.kubernetes.io/component=controller --tail=20",
      "description": "See Ingress Controller handling requests",
      "explanation": "Shows HTTP access logs from NGINX Ingress Controller. You should see entries for requests made in previous step.",
      "what_it_does": "Displays recent Ingress Controller logs.",
      "next_step": "Stop port-forward and cleanup."
    },
    {
      "name": "Cleanup: Stop Port-Forward",
      "command": "pkill -f 'port-forward.*ingress-demo-service' || true",
      "description": "Stop port-forward if running",
      "explanation": "Stops the background port-forward process started earlier.",
      "what_it_does": "Kills port-forward process.",
      "next_step": "Delete application resources.",
      "cleanup": true
    },
    {
      "name": "Cleanup: Delete Resources",
      "command": "kubectl delete -f deployment.yaml -n scenarios",
      "description": "Remove deployment, service, and Ingress",
      "explanation": "Deletes all resources created in this scenario.",
      "what_it_does": "Removes ingress-demo deployment, service, and Ingress.",
      "next_step": "Cleanup complete! Run validate.sh to confirm.",
      "cleanup": true
    }
  ]
}