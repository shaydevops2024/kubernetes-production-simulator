{
  "scenario_id": "07-self-healing",
  "difficulty": "easy",
  "duration": "15 min",
  "commands": [
    {
      "name": "Step 1: Create Namespace",
      "command": "kubectl create namespace scenarios --dry-run=client -o yaml | kubectl apply -f -",
      "description": "Create scenarios namespace",
      "explanation": "Creates namespace for self-healing demonstration.",
      "what_it_does": "Creates 'scenarios' namespace if needed.",
      "next_step": "Deploy application to demonstrate self-healing."
    },
    {
      "name": "Step 2: Deploy Application",
      "command": "kubectl apply -f k8s-scenarios/07-self-healing/deployment.yaml -f k8s-scenarios/07-self-healing/service.yaml -n scenarios",
      "description": "Deploy nginx deployment and service with 3 replicas",
      "explanation": "Creates deployment with 3 replicas and service. The ReplicaSet controller continuously monitors pod count and recreates pods if deleted, demonstrating Kubernetes self-healing capability.",
      "what_it_does": "Creates selfheal-demo deployment, selfheal-service, with 3 nginx pods.",
      "next_step": "Verify 3 pods are running."
    },
    {
      "name": "Step 3: List Running Pods",
      "command": "kubectl get pods -n scenarios -l app=selfheal-demo",
      "description": "View all 3 pods running",
      "explanation": "Should show 3 pods in Running state. Note the pod names - they have random suffixes. We'll delete one and see it recreated with a new name.",
      "what_it_does": "Lists all selfheal-demo pods with status.",
      "next_step": "Delete one pod to trigger self-healing."
    },
    {
      "name": "Step 4: Delete One Pod",
      "command": "POD=$(kubectl get pod -n scenarios -l app=selfheal-demo -o jsonpath='{.items[0].metadata.name}') && kubectl delete pod $POD -n scenarios",
      "description": "Delete a single pod",
      "explanation": "Deletes one pod. Kubernetes detects the pod is gone (current state: 2 pods, desired state: 3 pods) and immediately creates a replacement. This happens within seconds.",
      "what_it_does": "Deletes the first pod in the list.",
      "next_step": "Watch Kubernetes recreate the pod."
    },
    {
      "name": "Step 5: Watch Self-Healing",
      "command": "kubectl get pods -n scenarios -l app=selfheal-demo -w",
      "description": "Watch automatic pod recreation (Ctrl+C to stop)",
      "explanation": "You'll see: deleted pod in Terminating, new pod appearing in Pending, then ContainerCreating, then Running. Happens in 10-30 seconds. Press Ctrl+C when new pod is Running.",
      "what_it_does": "Streams live pod status updates showing recreation.",
      "next_step": "Verify 3 pods running again."
    },
    {
      "name": "Step 6: Verify Recovery",
      "command": "kubectl get pods -n scenarios -l app=selfheal-demo",
      "description": "Confirm 3 pods are running",
      "explanation": "Should show 3 Running pods again. Notice one pod has a newer AGE - that's the recreated pod. Self-healing successful!",
      "what_it_does": "Lists current pods showing recovered state.",
      "next_step": "Test mass deletion for stronger proof."
    },
    {
      "name": "Step 7: Delete All Pods",
      "command": "kubectl delete pods -n scenarios -l app=selfheal-demo",
      "description": "Delete all 3 pods simultaneously",
      "explanation": "Simulates catastrophic failure. Kubernetes immediately recreates all 3 pods. The service continues working as soon as first replacement is Ready. This is powerful self-healing.",
      "what_it_does": "Deletes all pods in the deployment at once.",
      "next_step": "Watch mass recreation."
    },
    {
      "name": "Step 8: Watch Mass Recovery",
      "command": "kubectl get pods -n scenarios -l app=selfheal-demo -w",
      "description": "Watch all pods recreate (Ctrl+C when all Running)",
      "explanation": "All 3 pods go through Terminating → gone → 3 new pods appear in Pending → ContainerCreating → Running. Takes 20-40 seconds total. Press Ctrl+C when all show Running.",
      "what_it_does": "Streams pod recreation showing all 3 recovered.",
      "next_step": "View scenario summary and key learnings."
    },
    {
      "name": "Step 9: Scenario Summary",
      "command": "echo 'Congratulations! You have completed the Self-Healing scenario.'",
      "description": "Review what you learned and commands used",
      "explanation": "In this scenario, you experienced Kubernetes self-healing capabilities. You created a deployment with 3 replicas, deleted individual pods and all pods simultaneously, and watched Kubernetes automatically recreate them to maintain the desired state. This demonstrates the power of declarative configuration and the reconciliation loop.",
      "what_it_does": "Displays completion message and summary of learning objectives achieved.",
      "next_step": "Ready for cleanup!",
      "show_yaml": true,
      "summary": {
        "key_learnings": [
          "Kubernetes maintains desired state automatically through reconciliation loops",
          "ReplicaSet controller ensures the correct number of pod replicas are always running",
          "Deleting pods triggers immediate automatic recreation",
          "Services remain available during pod recreation",
          "Self-healing works without manual intervention"
        ],
        "commands_used": [
          {
            "command": "kubectl create namespace scenarios",
            "purpose": "Created the namespace for running the scenario"
          },
          {
            "command": "kubectl apply -f deployment.yaml -f service.yaml",
            "purpose": "Deployed the application with 3 replicas and exposed it via a service"
          },
          {
            "command": "kubectl get pods -l app=selfheal-demo",
            "purpose": "Listed pods to verify the desired state (3 running pods)"
          },
          {
            "command": "kubectl delete pod <pod-name>",
            "purpose": "Deleted a single pod to trigger self-healing"
          },
          {
            "command": "kubectl get pods -w",
            "purpose": "Watched live pod status updates showing automatic recreation"
          },
          {
            "command": "kubectl delete pods -l app=selfheal-demo",
            "purpose": "Deleted all pods simultaneously to demonstrate mass recovery"
          }
        ]
      }
    },
    {
      "name": "Cleanup: Delete Resources",
      "command": "kubectl delete -f k8s-scenarios/07-self-healing/deployment.yaml -f k8s-scenarios/07-self-healing/service.yaml -n scenarios",
      "description": "Remove deployment and service",
      "explanation": "Deletes deployment, service, and all pods.",
      "what_it_does": "Removes selfheal-demo deployment and service.",
      "next_step": "Cleanup complete!",
      "cleanup": true
    }
  ]
}