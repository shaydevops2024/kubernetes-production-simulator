{
  "scenario_id": "11-job-cronjob",
  "difficulty": "medium",
  "duration": "20 min",
  "commands": [
    {
      "name": "Step 1: Create Namespace",
      "command": "kubectl create namespace scenarios --dry-run=client -o yaml | kubectl apply -f -",
      "description": "Create scenarios namespace",
      "explanation": "Creates namespace for Job and CronJob testing.",
      "what_it_does": "Creates 'scenarios' namespace if needed.",
      "next_step": "Create a one-time Job."
    },
    {
      "name": "Step 2: Create Job",
      "command": "kubectl apply -f k8s-scenarios/11-job-cronjob/job.yaml -n scenarios",
      "description": "Create one-time batch Job",
      "explanation": "Jobs run pods to completion (success or failure), then stop. Unlike Deployments which run continuously, Jobs are for finite tasks like batch processing, database migrations, or data exports.",
      "what_it_does": "Creates job-demo Job that runs a task once.",
      "next_step": "Watch Job execute and complete."
    },
    {
      "name": "Step 3: Watch Job Progress",
      "command": "kubectl get jobs job-demo -n scenarios -w",
      "description": "Monitor Job completion (Ctrl+C when COMPLETIONS shows 1/1)",
      "explanation": "Watch COMPLETIONS column change from 0/1 to 1/1. Job creates a pod, runs it to completion, then marks itself as succeeded. Takes 10-30 seconds.",
      "what_it_does": "Streams live Job status until completion.",
      "next_step": "Verify Job succeeded."
    },
    {
      "name": "Step 4: Check Job Status",
      "command": "kubectl get jobs job-demo -n scenarios",
      "description": "View Job completion status",
      "explanation": "COMPLETIONS should show 1/1 (one successful run out of one required). The Job is complete but not deleted - pods remain for log viewing.",
      "what_it_does": "Shows Job with completion count and status.",
      "next_step": "View Job pod logs."
    },
    {
      "name": "Step 5: View Job Logs",
      "command": "kubectl logs -n scenarios job/job-demo",
      "description": "See output from completed Job",
      "explanation": "Shows what the Job printed. Pods from completed Jobs remain (for debugging) until manually deleted or garbage collected.",
      "what_it_does": "Displays logs from the Job's pod.",
      "next_step": "Create a scheduled CronJob."
    },
    {
      "name": "Step 6: Create CronJob",
      "command": "kubectl apply -f k8s-scenarios/11-job-cronjob/cronjob.yaml -n scenarios",
      "description": "Create CronJob that runs every 5 minutes",
      "explanation": "CronJobs schedule Jobs on a time-based schedule using cron syntax. This one runs every 5 minutes (schedule: '*/5 * * * *'). It creates a new Job each time the schedule triggers.",
      "what_it_does": "Creates cronjob-demo CronJob with */5 * * * * schedule.",
      "next_step": "Wait for CronJob to create its first Job."
    },
    {
      "name": "Step 7: Check CronJob Status",
      "command": "kubectl get cronjob cronjob-demo -n scenarios",
      "description": "View CronJob schedule and last run time",
      "explanation": "SCHEDULE shows cron expression, LAST SCHEDULE shows when it last ran (may show <none> initially), ACTIVE shows currently running Jobs.",
      "what_it_does": "Displays CronJob with schedule and execution history.",
      "next_step": "Wait up to 5 minutes for next scheduled run."
    },
    {
      "name": "Step 8: Watch for Scheduled Job",
      "command": "kubectl get jobs -n scenarios -w",
      "description": "Watch CronJob create Jobs (Ctrl+C after seeing new job)",
      "explanation": "Every 5 minutes, CronJob creates a new Job with a name like cronjob-demo-1234567890. Watch for this. You may need to wait up to 5 minutes. Press Ctrl+C after seeing creation.",
      "what_it_does": "Streams live updates showing CronJob creating Jobs on schedule.",
      "next_step": "View CronJob execution history."
    },
    {
      "name": "Step 9: List All Jobs",
      "command": "kubectl get jobs -n scenarios",
      "description": "See Jobs created by CronJob",
      "explanation": "Shows job-demo (manual) and cronjob-demo-XXXXXX (from CronJob). CronJob keeps last 3 successful and 1 failed Job by default (successfulJobsHistoryLimit/failedJobsHistoryLimit).",
      "what_it_does": "Lists all Jobs including CronJob-generated ones.",
      "next_step": "Ready for cleanup!",
      "show_yaml": true
    },
    {
      "name": "Cleanup: Delete CronJob",
      "command": "kubectl delete cronjob cronjob-demo -n scenarios",
      "description": "Remove CronJob (stops future executions)",
      "explanation": "Deletes CronJob. Future scheduled runs won't happen. Existing Jobs remain.",
      "what_it_does": "Removes CronJob, preventing future scheduled executions.",
      "next_step": "Delete Jobs manually.",
      "cleanup": true
    },
    {
      "name": "Cleanup: Delete Jobs",
      "command": "kubectl delete jobs -n scenarios --all",
      "description": "Remove all Jobs and their pods",
      "explanation": "Deletes all Jobs (job-demo and CronJob-created ones) and their pods.",
      "what_it_does": "Removes all Job resources from scenarios namespace.",
      "next_step": "Cleanup complete!",
      "cleanup": true
    }
  ]
}