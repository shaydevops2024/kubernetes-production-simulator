{
  "scenario_id": "04-vpc-networking-from-scratch",
  "difficulty": "easy",
  "duration": "20 min",
  "commands": [
    {
      "name": "Step 1: Create the VPC Resource",
      "command": "cat << 'TFEOF'\n# vpc.tf - Virtual Private Cloud\n# A VPC is an isolated virtual network in AWS where you launch resources.\n\nresource \"aws_vpc\" \"main\" {\n  cidr_block = \"10.0.0.0/16\"\n\n  # Enable DNS support so resources can resolve hostnames\n  enable_dns_support   = true\n  enable_dns_hostnames = true\n\n  tags = {\n    Name        = \"production-vpc\"\n    Environment = \"prod\"\n    ManagedBy   = \"terraform\"\n  }\n}\nTFEOF\necho ''\necho '=== CIDR Block Explained ==='\necho ''\necho '  10.0.0.0/16 provides:'\necho '    - 65,536 IP addresses (10.0.0.0 to 10.0.255.255)'\necho '    - Enough room for hundreds of subnets'\necho '    - /16 is the most common VPC size in production'\necho ''\necho '  Common VPC CIDR patterns:'\necho '    /16 = 65,536 IPs  (production, multi-AZ workloads)'\necho '    /20 = 4,096 IPs   (small environments, dev/test)'\necho '    /24 = 256 IPs     (single-purpose VPCs, VPN endpoints)'\necho ''\necho '  IMPORTANT: Choose a CIDR that does not overlap with:'\necho '    - Other VPCs you might peer with'\necho '    - Your on-premise network (if using VPN/Direct Connect)'\necho '    - Common defaults like 172.31.0.0/16 (AWS default VPC)'\necho ''\necho '  enable_dns_hostnames = true is required for:'\necho '    - EKS clusters'\necho '    - RDS instances (they need DNS names)'\necho '    - Any service that uses private DNS'",
      "description": "Create a VPC with a /16 CIDR block and DNS support enabled for production workloads",
      "explanation": "A VPC (Virtual Private Cloud) is the networking foundation for all AWS resources. The CIDR block defines the IP address range available within the VPC. A /16 provides 65,536 addresses, which is the standard for production workloads because it allows plenty of room for subnets across multiple availability zones. DNS support and hostnames must be enabled for services like EKS and RDS that rely on DNS resolution. Choosing a non-overlapping CIDR is critical if you plan to use VPC peering, Transit Gateway, or VPN connections to other networks.",
      "what_it_does": "Displays the VPC resource with a 10.0.0.0/16 CIDR block, DNS settings enabled, and explains CIDR sizing, common patterns, and the importance of avoiding IP range conflicts.",
      "next_step": "Next we will create public subnets across three availability zones.",
      "cleanup": false
    },
    {
      "name": "Step 2: Create Public Subnets Across Availability Zones",
      "command": "cat << 'TFEOF'\n# public-subnets.tf - Public Subnets (Internet-Facing)\n# Public subnets have a route to the internet via an Internet Gateway.\n# Resources here get public IP addresses.\n\nvariable \"availability_zones\" {\n  default = [\"us-east-1a\", \"us-east-1b\", \"us-east-1c\"]\n}\n\nresource \"aws_subnet\" \"public\" {\n  count = 3\n\n  vpc_id            = aws_vpc.main.id\n  cidr_block        = cidrsubnet(\"10.0.0.0/16\", 8, count.index)\n  availability_zone = var.availability_zones[count.index]\n\n  # Auto-assign public IPs to instances launched in this subnet\n  map_public_ip_on_launch = true\n\n  tags = {\n    Name = \"public-subnet-${var.availability_zones[count.index]}\"\n    Type = \"public\"\n    Tier = \"web\"\n  }\n}\nTFEOF\necho ''\necho '=== cidrsubnet() Function Explained ==='\necho ''\necho '  cidrsubnet(\"10.0.0.0/16\", 8, index)'\necho '    - Base: 10.0.0.0/16'\necho '    - New bits: 8 (16 + 8 = /24 subnets)'\necho '    - Index: Which subnet number'\necho ''\necho '  Results:'\necho '    count.index = 0  ->  10.0.0.0/24   (us-east-1a)  256 IPs'\necho '    count.index = 1  ->  10.0.1.0/24   (us-east-1b)  256 IPs'\necho '    count.index = 2  ->  10.0.2.0/24   (us-east-1c)  256 IPs'\necho ''\necho '  Each /24 subnet provides 251 usable IPs (AWS reserves 5).'\necho ''\necho '=== Why 3 Availability Zones? ==='\necho ''\necho '  - High availability: survive the failure of any single AZ'\necho '  - Required by services like EKS (minimum 2, recommend 3)'\necho '  - Spread load across physical data centers'\necho '  - AWS SLA requires multi-AZ for production workloads'",
      "description": "Create three public subnets using count and cidrsubnet() across availability zones for high availability",
      "explanation": "Public subnets host internet-facing resources like load balancers, bastion hosts, and NAT gateways. The count meta-argument creates three identical subnets with different CIDR blocks and availability zones. The cidrsubnet() function mathematically calculates non-overlapping CIDR blocks from the VPC CIDR, eliminating manual IP math errors. Setting map_public_ip_on_launch to true means EC2 instances automatically get public IPs. Spreading subnets across three AZs ensures high availability -- if one AZ fails, resources in the other two continue serving traffic.",
      "what_it_does": "Displays three public subnet resources created with count, shows how cidrsubnet() calculates /24 blocks from the /16 VPC CIDR, and explains why multi-AZ deployment is essential for production.",
      "next_step": "Now let's create private subnets for backend services and databases.",
      "cleanup": false
    },
    {
      "name": "Step 3: Create Private Subnets Across Availability Zones",
      "command": "cat << 'TFEOF'\n# private-subnets.tf - Private Subnets (No Direct Internet Access)\n# Private subnets have NO direct route to the internet.\n# Resources here are protected from inbound internet traffic.\n\nresource \"aws_subnet\" \"private\" {\n  count = 3\n\n  vpc_id            = aws_vpc.main.id\n  cidr_block        = cidrsubnet(\"10.0.0.0/16\", 8, count.index + 100)\n  availability_zone = var.availability_zones[count.index]\n\n  # No public IPs - these are private resources\n  map_public_ip_on_launch = false\n\n  tags = {\n    Name = \"private-subnet-${var.availability_zones[count.index]}\"\n    Type = \"private\"\n    Tier = \"application\"\n  }\n}\nTFEOF\necho ''\necho '=== Private Subnet CIDR Calculation ==='\necho ''\necho '  cidrsubnet(\"10.0.0.0/16\", 8, index + 100)'\necho ''\necho '  Results:'\necho '    count.index = 0  ->  10.0.100.0/24  (us-east-1a)  256 IPs'\necho '    count.index = 1  ->  10.0.101.0/24  (us-east-1b)  256 IPs'\necho '    count.index = 2  ->  10.0.102.0/24  (us-east-1c)  256 IPs'\necho ''\necho '=== Public vs Private Subnet Layout ==='\necho ''\necho '  VPC: 10.0.0.0/16'\necho '  ├── Public Subnets  (internet-facing)'\necho '  │   ├── 10.0.0.0/24    us-east-1a   [ALB, NAT GW, Bastion]'\necho '  │   ├── 10.0.1.0/24    us-east-1b   [ALB, NAT GW backup]'\necho '  │   └── 10.0.2.0/24    us-east-1c   [ALB]'\necho '  │'\necho '  └── Private Subnets (protected)'\necho '      ├── 10.0.100.0/24  us-east-1a   [App servers, EKS nodes]'\necho '      ├── 10.0.101.0/24  us-east-1b   [App servers, RDS primary]'\necho '      └── 10.0.102.0/24  us-east-1c   [App servers, RDS replica]'\necho ''\necho '  Using index + 100 creates a clear visual gap between'\necho '  public (0-2) and private (100-102) subnets in the CIDR space.'",
      "description": "Create three private subnets for backend services using an offset CIDR range across availability zones",
      "explanation": "Private subnets host resources that should never be directly accessible from the internet: application servers, databases, cache clusters, and EKS worker nodes. By using count.index + 100 in the cidrsubnet function, we create a clear numerical gap between public and private CIDR ranges, making the network layout easy to understand. Private subnets do not assign public IPs and have no direct route to the internet. To access the internet (for package updates, API calls, etc.), private resources use a NAT gateway in the public subnet.",
      "what_it_does": "Displays three private subnet resources with offset CIDRs (10.0.100-102.0/24), shows the complete VPC subnet layout in an ASCII diagram, and explains what resources belong in each subnet tier.",
      "next_step": "Next we will create an internet gateway to give public subnets internet access.",
      "cleanup": false
    },
    {
      "name": "Step 4: Create the Internet Gateway",
      "command": "cat << 'TFEOF'\n# internet-gateway.tf - Internet Gateway\n# The IGW enables communication between the VPC and the internet.\n# It is the entry/exit point for all public subnet traffic.\n\nresource \"aws_internet_gateway\" \"main\" {\n  vpc_id = aws_vpc.main.id\n\n  tags = {\n    Name        = \"production-igw\"\n    Environment = \"prod\"\n    ManagedBy   = \"terraform\"\n  }\n}\nTFEOF\necho ''\necho '=== How the Internet Gateway Works ==='\necho ''\necho '  INBOUND (Internet -> VPC):'\necho '    User Request'\necho '      -> Internet'\necho '        -> Internet Gateway'\necho '          -> Route Table (destination matching)'\necho '            -> Public Subnet'\necho '              -> Security Group (firewall rules)'\necho '                -> EC2 Instance / ALB'\necho ''\necho '  OUTBOUND (VPC -> Internet):'\necho '    EC2 Instance'\necho '      -> Route Table (0.0.0.0/0 -> igw-xxxxx)'\necho '        -> Internet Gateway'\necho '          -> Internet'\necho ''\necho '=== Key Facts ==='\necho ''\necho '  - One IGW per VPC (AWS enforced limit)'\necho '  - Horizontally scaled, redundant, high availability by AWS'\necho '  - No bandwidth constraints, no availability risk'\necho '  - Free -- no hourly charge (you pay for data transfer)'\necho '  - Performs 1:1 NAT for instances with public IPs'\necho '  - Only works with PUBLIC subnets (subnets that route to it)'\necho '  - Does NOT provide internet to private subnets (use NAT GW)'",
      "description": "Create an internet gateway and understand how it enables bidirectional internet communication for public subnets",
      "explanation": "An Internet Gateway (IGW) is an AWS-managed, highly available component that allows communication between your VPC and the internet. It performs two functions: it provides a target in your route tables for internet-routable traffic, and it performs network address translation (NAT) for instances with public IP addresses. The IGW is inherently redundant and horizontally scaled by AWS -- you do not need to worry about its availability or bandwidth. There is no cost for the IGW itself; you only pay for data transfer. A subnet is only 'public' if its route table has a route to the IGW.",
      "what_it_does": "Displays the internet gateway resource, shows the inbound and outbound traffic flow through the gateway, and lists key facts including that it is free, highly available, and only serves public subnets.",
      "next_step": "Now let's create a NAT gateway so private subnets can reach the internet for outbound traffic.",
      "cleanup": false
    },
    {
      "name": "Step 5: Create NAT Gateway with Elastic IP",
      "command": "cat << 'TFEOF'\n# nat-gateway.tf - NAT Gateway with Elastic IP\n# NAT GW allows private subnet resources to reach the internet\n# for outbound traffic (updates, API calls) WITHOUT exposing them\n# to inbound internet traffic.\n\n# Elastic IP for the NAT Gateway (static public IP)\nresource \"aws_eip\" \"nat\" {\n  domain = \"vpc\"\n\n  tags = {\n    Name = \"nat-gateway-eip\"\n  }\n\n  # Ensure IGW exists before creating EIP\n  depends_on = [aws_internet_gateway.main]\n}\n\n# NAT Gateway sits in a PUBLIC subnet but serves PRIVATE subnets\nresource \"aws_nat_gateway\" \"main\" {\n  allocation_id = aws_eip.nat.id\n  subnet_id     = aws_subnet.public[0].id    # Place in first public subnet\n\n  tags = {\n    Name = \"production-nat-gw\"\n  }\n\n  depends_on = [aws_internet_gateway.main]\n}\nTFEOF\necho ''\necho '=== NAT Gateway Traffic Flow ==='\necho ''\necho '  Private Instance (10.0.100.50)'\necho '    -> Private Route Table (0.0.0.0/0 -> nat-gw-xxxxx)'\necho '      -> NAT Gateway (in public subnet, has EIP 54.210.45.67)'\necho '        -> Internet Gateway'\necho '          -> Internet'\necho ''\necho '  The internet sees traffic from 54.210.45.67 (the EIP),'\necho '  NOT from the private instance IP. Responses are routed back'\necho '  through the NAT GW to the private instance.'\necho ''\necho '=== Cost Warning ==='\necho ''\necho '  NAT Gateway pricing (us-east-1):'\necho '    - $0.045/hour   = ~$32.40/month  (just for existing!)'\necho '    - $0.045/GB     processed data'\necho ''\necho '  Cost optimization strategies:'\necho '    1. Use one NAT GW for dev/staging (shown here)'\necho '    2. Use one NAT GW per AZ for production (higher availability)'\necho '    3. Consider NAT instances (EC2) for dev to save costs'\necho '    4. Use VPC endpoints for S3/DynamoDB to avoid NAT charges'",
      "description": "Create a NAT gateway with Elastic IP in the public subnet to provide outbound internet access for private subnets",
      "explanation": "A NAT (Network Address Translation) Gateway allows resources in private subnets to initiate outbound connections to the internet (for software updates, API calls, etc.) without being directly accessible from the internet. The NAT Gateway must be placed in a public subnet and needs an Elastic IP (static public IP address). All outbound traffic from private subnets is translated to the NAT Gateway's EIP. The depends_on ensures the IGW exists before the NAT Gateway, because the NAT Gateway requires internet connectivity. NAT Gateways are a significant cost item -- approximately $32/month just for existing -- so cost optimization is important.",
      "what_it_does": "Displays the Elastic IP and NAT Gateway resources, shows the complete outbound traffic flow from private instances through the NAT Gateway to the internet, and warns about NAT Gateway costs with optimization strategies.",
      "next_step": "Now let's create route tables to control where traffic flows.",
      "cleanup": false
    },
    {
      "name": "Step 6: Create Public and Private Route Tables",
      "command": "cat << 'TFEOF'\n# route-tables.tf - Route Tables for Public and Private Subnets\n# Route tables control where network traffic is directed.\n\n# --- PUBLIC Route Table ---\n# Routes internet traffic through the Internet Gateway\nresource \"aws_route_table\" \"public\" {\n  vpc_id = aws_vpc.main.id\n\n  route {\n    cidr_block = \"0.0.0.0/0\"          # All internet traffic\n    gateway_id = aws_internet_gateway.main.id\n  }\n\n  tags = {\n    Name = \"public-route-table\"\n    Type = \"public\"\n  }\n}\n\n# --- PRIVATE Route Table ---\n# Routes internet traffic through the NAT Gateway\nresource \"aws_route_table\" \"private\" {\n  vpc_id = aws_vpc.main.id\n\n  route {\n    cidr_block     = \"0.0.0.0/0\"      # All internet traffic\n    nat_gateway_id = aws_nat_gateway.main.id\n  }\n\n  tags = {\n    Name = \"private-route-table\"\n    Type = \"private\"\n  }\n}\nTFEOF\necho ''\necho '=== Route Table Comparison ==='\necho ''\necho '  PUBLIC Route Table:'\necho '  ┌──────────────────┬─────────────────────┐'\necho '  │  Destination     │  Target              │'\necho '  ├──────────────────┼─────────────────────┤'\necho '  │  10.0.0.0/16     │  local (implicit)    │'\necho '  │  0.0.0.0/0       │  igw-xxxxx (IGW)     │'\necho '  └──────────────────┴─────────────────────┘'\necho ''\necho '  PRIVATE Route Table:'\necho '  ┌──────────────────┬─────────────────────┐'\necho '  │  Destination     │  Target              │'\necho '  ├──────────────────┼─────────────────────┤'\necho '  │  10.0.0.0/16     │  local (implicit)    │'\necho '  │  0.0.0.0/0       │  nat-xxxxx (NAT GW)  │'\necho '  └──────────────────┴─────────────────────┘'\necho ''\necho '  The \"local\" route is automatically added by AWS.'\necho '  It ensures all VPC-internal traffic stays within the VPC.'\necho '  The 0.0.0.0/0 route is the \"default route\" for all other traffic.'\necho ''\necho '  KEY DIFFERENCE: Public routes to IGW (direct internet).'\necho '                  Private routes to NAT GW (translated internet).'",
      "description": "Create public and private route tables that direct traffic to the internet gateway and NAT gateway respectively",
      "explanation": "Route tables are the traffic directors of your VPC. Every subnet must be associated with a route table that determines where its traffic goes. The public route table sends all non-VPC traffic (0.0.0.0/0) to the Internet Gateway for direct internet access. The private route table sends the same traffic to the NAT Gateway for translated outbound access. AWS automatically adds a 'local' route (10.0.0.0/16 -> local) that keeps VPC-internal traffic within the VPC. This is what makes the distinction between public and private subnets -- it is purely about which route table they use, not any property of the subnet itself.",
      "what_it_does": "Displays public and private route table resources, shows a side-by-side comparison of their routing rules in ASCII tables, and explains the implicit local route and how route tables define whether a subnet is public or private.",
      "next_step": "Now let's associate subnets with their correct route tables.",
      "cleanup": false
    },
    {
      "name": "Step 7: Associate Subnets with Route Tables",
      "command": "cat << 'TFEOF'\n# route-table-associations.tf\n# Each subnet MUST be associated with a route table.\n# Without an explicit association, the VPC main route table is used.\n\n# Associate PUBLIC subnets with the public route table\nresource \"aws_route_table_association\" \"public\" {\n  count = 3\n\n  subnet_id      = aws_subnet.public[count.index].id\n  route_table_id = aws_route_table.public.id\n}\n\n# Associate PRIVATE subnets with the private route table\nresource \"aws_route_table_association\" \"private\" {\n  count = 3\n\n  subnet_id      = aws_subnet.private[count.index].id\n  route_table_id = aws_route_table.private.id\n}\nTFEOF\necho ''\necho '=== Association Summary ==='\necho ''\necho '  Public Route Table (igw-xxxxx):'\necho '    ├── public-subnet-us-east-1a   (10.0.0.0/24)'\necho '    ├── public-subnet-us-east-1b   (10.0.1.0/24)'\necho '    └── public-subnet-us-east-1c   (10.0.2.0/24)'\necho ''\necho '  Private Route Table (nat-xxxxx):'\necho '    ├── private-subnet-us-east-1a  (10.0.100.0/24)'\necho '    ├── private-subnet-us-east-1b  (10.0.101.0/24)'\necho '    └── private-subnet-us-east-1c  (10.0.102.0/24)'\necho ''\necho '  Total: 6 associations (3 public + 3 private)'\necho ''\necho '=== IMPORTANT ==='\necho ''\necho '  Without explicit associations, subnets use the VPC main route table,'\necho '  which has NO internet route by default. This means:'\necho '    - Resources cannot reach the internet'\necho '    - The subnet is effectively isolated'\necho '  Always create explicit associations to avoid confusion.'",
      "description": "Associate each subnet with the correct route table to establish public and private network paths",
      "explanation": "Route table associations are the final link that makes subnets truly public or private. Using count, we create three associations for public subnets (pointing to the public route table with the IGW route) and three for private subnets (pointing to the private route table with the NAT GW route). Without explicit associations, subnets fall back to the VPC's main route table, which typically has no internet route. This is a common source of connectivity issues -- always create explicit associations to make the routing intent clear and auditable.",
      "what_it_does": "Displays the route table association resources using count, shows which subnets are associated with which route table in an ASCII tree, and warns about the default behavior when associations are missing.",
      "next_step": "Let's verify the complete network topology and see the terraform plan summary.",
      "cleanup": false
    },
    {
      "name": "Step 8: Verify Full Topology and Plan Summary",
      "command": "echo '=== Complete VPC Network Topology ==='\necho ''\necho '                        INTERNET'\necho '                           |'\necho '                    ┌──────┴──────┐'\necho '                    │ Internet GW │'\necho '                    └──────┬──────┘'\necho '                           |'\necho '          ┌────────────────┼────────────────┐'\necho '          |                |                |'\necho '   ┌──────┴──────┐ ┌──────┴──────┐ ┌──────┴──────┐'\necho '   │ Public 1a   │ │ Public 1b   │ │ Public 1c   │'\necho '   │ 10.0.0.0/24 │ │ 10.0.1.0/24 │ │ 10.0.2.0/24 │'\necho '   │ [ALB, NAT]  │ │   [ALB]     │ │   [ALB]     │'\necho '   └──────┬──────┘ └─────────────┘ └─────────────┘'\necho '          |'\necho '   ┌──────┴──────┐'\necho '   │   NAT GW    │'\necho '   │ EIP: 54.x.x │'\necho '   └──────┬──────┘'\necho '          |'\necho '          ┌────────────────┼────────────────┐'\necho '          |                |                |'\necho '   ┌──────┴──────┐ ┌──────┴──────┐ ┌──────┴──────┐'\necho '   │ Private 1a  │ │ Private 1b  │ │ Private 1c  │'\necho '   │10.0.100/24  │ │10.0.101/24  │ │10.0.102/24  │'\necho '   │ [App, EKS]  │ │ [App, RDS]  │ │ [App, RDS]  │'\necho '   └─────────────┘ └─────────────┘ └─────────────┘'\necho ''\necho '=== terraform plan summary ==='\necho ''\necho '  + aws_vpc.main                                 # The VPC'\necho '  + aws_subnet.public[0]                         # Public subnet 1a'\necho '  + aws_subnet.public[1]                         # Public subnet 1b'\necho '  + aws_subnet.public[2]                         # Public subnet 1c'\necho '  + aws_subnet.private[0]                        # Private subnet 1a'\necho '  + aws_subnet.private[1]                        # Private subnet 1b'\necho '  + aws_subnet.private[2]                        # Private subnet 1c'\necho '  + aws_internet_gateway.main                    # Internet Gateway'\necho '  + aws_eip.nat                                  # Elastic IP'\necho '  + aws_nat_gateway.main                         # NAT Gateway'\necho '  + aws_route_table.public                       # Public routes'\necho '  + aws_route_table.private                      # Private routes'\necho '  + aws_route_table_association.public[0]         # Public assoc 1a'\necho '  + aws_route_table_association.public[1]         # Public assoc 1b'\necho '  + aws_route_table_association.public[2]         # Public assoc 1c'\necho '  + aws_route_table_association.private[0]        # Private assoc 1a'\necho '  + aws_route_table_association.private[1]        # Private assoc 1b'\necho '  + aws_route_table_association.private[2]        # Private assoc 1c'\necho ''\necho '  Plan: 18 to add, 0 to change, 0 to destroy.'\necho ''\necho '=== Production Enhancements ==='\necho '  - Add one NAT GW per AZ for high availability ($32/mo each)'\necho '  - Add VPC Flow Logs for network auditing'\necho '  - Add VPC Endpoints for S3/DynamoDB to reduce NAT costs'\necho '  - Add Network ACLs as a second layer of defense'\necho '  - Tag subnets for EKS: kubernetes.io/role/elb = 1 (public)'\necho '                         kubernetes.io/role/internal-elb = 1 (private)'",
      "description": "View the complete VPC network topology diagram and terraform plan summary with all 18 resources",
      "explanation": "This step brings everything together into a complete picture. The topology shows how internet traffic flows through the Internet Gateway to public subnets, and how the NAT Gateway in the public subnet provides outbound internet access for private subnets. The plan summary shows all 18 resources that Terraform will create. In production, you would add a NAT Gateway in each AZ for high availability (if one AZ fails, private subnets in other AZs still have internet access), VPC Flow Logs for compliance and debugging, and VPC Endpoints to reduce NAT Gateway data processing costs for AWS service traffic.",
      "what_it_does": "Displays a complete ASCII network topology diagram, lists all 18 resources in the terraform plan, and suggests production enhancements including multi-AZ NAT, flow logs, VPC endpoints, and EKS subnet tags.",
      "next_step": "Let's clean up and review what was learned.",
      "cleanup": false
    },
    {
      "name": "Step 9: Cleanup",
      "command": "echo '=== Scenario Complete ==='\necho ''\necho 'In a real environment, you would run:'\necho '  terraform destroy'\necho ''\necho 'Terraform destroys in reverse dependency order:'\necho '  1. Route table associations (6)'\necho '  2. Route tables (2)'\necho '  3. NAT Gateway (1) -- takes 1-2 minutes to delete'\necho '  4. Elastic IP (1)'\necho '  5. Internet Gateway (1)'\necho '  6. Subnets (6) -- public and private'\necho '  7. VPC (1) -- last because everything depends on it'\necho ''\necho '  Destroy complete! Resources: 18 destroyed.'\necho ''\necho '=== Summary: VPC Networking from Scratch ==='\necho ''\necho 'COMPONENTS CREATED:'\necho '  VPC (10.0.0.0/16)         - Isolated virtual network'\necho '  Public Subnets (x3)       - Internet-facing, auto-assign public IPs'\necho '  Private Subnets (x3)      - Protected, no direct internet access'\necho '  Internet Gateway           - Entry/exit for public subnet traffic'\necho '  NAT Gateway + EIP          - Outbound internet for private subnets'\necho '  Route Tables (x2)          - Direct traffic to IGW or NAT GW'\necho '  Associations (x6)          - Link subnets to route tables'\necho ''\necho 'KEY CONCEPTS:'\necho '  1. A subnet is PUBLIC because its route table points to an IGW'\necho '  2. A subnet is PRIVATE because its route table points to a NAT GW'\necho '  3. Use cidrsubnet() to calculate non-overlapping CIDR blocks'\necho '  4. Spread subnets across 3 AZs for high availability'\necho '  5. NAT Gateways cost ~$32/month -- use VPC endpoints to reduce costs'\necho '  6. This VPC pattern is the foundation for EKS, RDS, and ALB deployments'",
      "description": "Clean up and review the complete VPC networking architecture and key concepts learned",
      "explanation": "This scenario covered the complete networking foundation for production AWS workloads. The VPC with public and private subnets across three availability zones is the standard architecture pattern used by virtually every production AWS deployment. Understanding this topology is essential because it underpins every other AWS service -- EKS clusters, RDS databases, Application Load Balancers, and Lambda functions all depend on a well-designed VPC. The key insight is that public vs private is determined entirely by route tables, not by any inherent subnet property.",
      "what_it_does": "Summarizes the scenario with the destroy order showing reverse dependencies, lists all components created, and provides key networking concepts including what makes subnets public or private and why this VPC pattern is foundational for production.",
      "next_step": "Try the next scenario to learn about security groups and IAM roles.",
      "cleanup": true
    }
  ]
}
