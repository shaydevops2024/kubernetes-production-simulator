{
  "scenario_id": "04-app-of-apps",
  "difficulty": "medium",
  "duration": "20 min",
  "commands": [
    {
      "name": "Step 1: Review the Parent Application",
      "command": "cat argocd-scenarios/04-app-of-apps/parent-application.yaml",
      "description": "Review the parent Application CR that manages child applications",
      "explanation": "The parent Application points to the children/ directory, which contains other Application CRs. When ArgoCD syncs the parent, it creates the child Application resources in the argocd namespace. Each child then independently manages its own resources.",
      "what_it_does": "Displays the parent Application CR that orchestrates child apps.",
      "next_step": "Review the child Application definitions."
    },
    {
      "name": "Step 2: Review Child Applications",
      "command": "cat argocd-scenarios/04-app-of-apps/children/frontend-app.yaml && cat argocd-scenarios/04-app-of-apps/children/backend-app.yaml",
      "description": "Review the child Application CRs for frontend and backend",
      "explanation": "Each child Application is a full ArgoCD Application CR that points to its own manifests directory. The frontend app deploys nginx, and the backend app deploys httpd. Both deploy to the same namespace (argocd-sc-04) but manage independent resources.",
      "what_it_does": "Displays both child Application CR definitions.",
      "next_step": "Apply only the parent Application - children will be created automatically."
    },
    {
      "name": "Step 3: Apply ONLY the Parent Application",
      "command": "kubectl apply -f argocd-scenarios/04-app-of-apps/parent-application.yaml",
      "description": "Create the parent app - it will auto-create child applications",
      "explanation": "You only need to apply the parent Application. ArgoCD will sync the parent, discover the child Application CRs in the children/ directory, and create them automatically. Each child then syncs its own manifests. This is the power of App-of-Apps!",
      "what_it_does": "Creates the parent Application which cascades to create children.",
      "next_step": "Watch ArgoCD create and sync child applications."
    },
    {
      "name": "Step 4: Watch Child Apps Being Created",
      "type": "info",
      "command": "",
      "description": "Watch ArgoCD auto-create child applications from the parent",
      "explanation": "In the ArgoCD UI, you will see three applications appear: the parent app (sc04-parent-app) and two children (sc04-frontend, sc04-backend). The parent app shows the child Application CRs as its managed resources. Each child app shows its own Deployment and Service.",
      "what_it_does": "Shows the parent-child relationship in the ArgoCD UI.",
      "next_step": "Verify all resources are deployed across all apps.",
      "info_steps": [
        "Open ArgoCD UI (use the button above)",
        "Wait a few seconds and refresh",
        "You should see <strong>3 apps</strong>: sc04-parent-app, sc04-frontend, sc04-backend",
        "Click on <strong>sc04-parent-app</strong> — it shows the child Application CRs as its managed resources"
      ]
    },
    {
      "name": "Step 5: Verify All Deployed Resources",
      "command": "kubectl get applications -n argocd | grep sc04 && kubectl get deployment,service -n argocd-sc-04 -l app=frontend 2>/dev/null && kubectl get deployment,service -n argocd-sc-04 -l app=backend 2>/dev/null && kubectl get pods -n argocd-sc-04",
      "description": "Verify all resources deployed by both child applications",
      "explanation": "You should see both frontend and backend deployments running with their services. All of these were deployed by applying a single parent Application CR. This pattern scales to hundreds of services - just add more child Application CRs to the children/ directory.",
      "what_it_does": "Lists all resources deployed by the App-of-Apps pattern.",
      "next_step": "Understand the power and use cases of this pattern."
    },
    {
      "name": "Step 6: Explore App-of-Apps in ArgoCD UI",
      "type": "info",
      "command": "",
      "description": "Explore the App-of-Apps hierarchy in ArgoCD UI",
      "explanation": "The ArgoCD UI shows the hierarchy clearly. The parent app manages Application CRs, while each child manages its own Kubernetes resources. This separation allows teams to independently manage their services while platform teams control the overall structure.",
      "what_it_does": "Guides you through the ArgoCD UI to understand the App-of-Apps hierarchy.",
      "next_step": "Scenario complete! Clean up when ready.",
      "info_steps": [
        "Open ArgoCD UI (use the button above)",
        "Click on <strong>sc04-parent-app</strong> — see the child Application CRs as its managed resources",
        "Click on <strong>sc04-frontend</strong> — see its Deployment and Service",
        "Click on <strong>sc04-backend</strong> — see its Deployment and Service",
        "This is the App-of-Apps pattern: one entry point, independent lifecycle per service, easy to add more by dropping a new child App CR into the children/ directory"
      ]
    },
    {
      "name": "Cleanup: Delete Parent Application (cascades to children)",
      "command": "kubectl delete application sc04-parent-app -n argocd && sleep 5 && kubectl delete application sc04-frontend sc04-backend -n argocd --ignore-not-found && kubectl delete namespace argocd-sc-04 --ignore-not-found",
      "description": "Delete the parent app - child apps and resources are also removed",
      "explanation": "Deleting the parent Application triggers ArgoCD to prune the child Applications (since prune: true is set). The child Applications in turn clean up their resources. We also explicitly delete children and namespace as a safety net.",
      "what_it_does": "Cascading delete of parent, children, and all deployed resources.",
      "next_step": "Cleanup complete!",
      "cleanup": true
    }
  ]
}
